package ch.heigvd.storagemalware.services;

import ch.heigvd.storagemalware.models.Malware;

import javax.ejb.EJB;
import javax.ejb.Stateless;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * Service for malwares
 */
@Stateless
public class MalwaresManager implements MalwaresManagerLocal {


    private static final int MAX_DATABASE_DELAY_MS = 0;

    @EJB
    MalwaresDataStoreLocal malwaresDataStoreLocal;


    /**
     * Ask dao service to get all malware in the database
     * @return list of malwares
     */
    @Override
    public List<Malware> getAllMalwares()
    {
        simulateDatabaseDelay();
        return malwaresDataStoreLocal.getAllMalwares();
    }

    /**
     * Ask dao service to store a malware in the database
     * @param malware to store
     */
    @Override
    public void storeMalware(Malware malware) {
        simulateDatabaseDelay();
        malwaresDataStoreLocal.storeMalware(malware);
    }

    private void simulateDatabaseDelay() {
        long simulatedDatabaseLookupTime = (long)(Math.random() * MAX_DATABASE_DELAY_MS);
        try {
            Thread.sleep(simulatedDatabaseLookupTime);
        } catch (InterruptedException ex) {
            Logger.getLogger(MalwaresManager.class.getName()).log(Level.SEVERE, null, ex);
        }

    }

}
