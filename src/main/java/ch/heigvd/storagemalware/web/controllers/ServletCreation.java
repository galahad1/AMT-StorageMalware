package ch.heigvd.storagemalware.web.controllers;



import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;


public class ServletCreation extends HttpServlet {

    public static final String CHAMP_NOM = "nom";
    public static final String CHAMP_HASH = "hash";
    public static final String CHAMP_CATEGORY = "category";
    public static final String CHAMP_DATE = "date";






    public void doGet( HttpServletRequest request, HttpServletResponse response ) throws ServletException, IOException{

        /* Affichage de la page de creation */


        request.getRequestDispatcher("/WEB-INF/views/creation.jsp").forward(request, response);

    }



    public void doPost( HttpServletRequest request, HttpServletResponse response ) throws ServletException, IOException{

        /* Traitement des données du formulaire */

        String nom = request.getParameter( CHAMP_NOM );

        String hash = request.getParameter( CHAMP_HASH );

        String category = request.getParameter( CHAMP_CATEGORY );

        String date = request.getParameter( CHAMP_DATE );


        try {

            validationNom( nom );

            validationCategory( category );

            validationDate( date );

        } catch (Exception e) {

            /* Gérer les erreurs de validation ici. */

        }
        this.getServletContext().getRequestDispatcher("/WEB-INF/views/creation.jsp").forward( request, response );
    }
    private void validationDate( String date ) throws Exception {

        if ( date != null && date.trim().length() != 0 ) {

            if ( !date.matches( "([^.@]+)(\\.[^.@]+)*@([^.@]+\\.)+([^.@]+)" ) ) {

                throw new Exception( "Merci de saisir une date valide." );

            }

        } else {

            throw new Exception( "Merci de saisir une date." );

        }

    }

    private void validationCategory( String category ) throws Exception{

        if (category != null && category.trim().length() != 0 ) {

             if (category.trim().length() < 3) {

                throw new Exception("La catégorie doit contenir au moins 3 caractères.");
            }

        } else {

            throw new Exception("Merci de saisir et confirmer votre mot de passe.");

        }
    }

    private void validationNom ( String nom ) throws Exception {

        if ( nom != null && nom.trim().length() < 3 ) {

            throw new Exception( "Le nom du malware doit contenir au moins 3 caractères." );

        }

    }

}