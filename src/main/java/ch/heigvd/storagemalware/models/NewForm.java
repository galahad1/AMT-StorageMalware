package ch.heigvd.storagemalware.models;

import java.util.HashMap;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

public class NewForm {

    private static final String FIELD_NAME = "name";
    private static final String FIELD_HASH = "hash";
    private static final String FIELD_CATEGORY = "category";
    private static final String FIELD_DATE = "date";
    private String results;
    private Map<String, String> errors = new HashMap<String, String>();

    public String getResultat() {
        return results;
    }

    public Map<String, String> getErrors() {
        return errors;
    }

    public Malware validateMalware(HttpServletRequest request) {
        String name = getValuefield(request, FIELD_NAME);
        String hash = getValuefield(request, FIELD_HASH);
        String category = getValuefield(request, FIELD_CATEGORY);
        String creation = getValuefield(request, FIELD_DATE);

        Malware malware = new Malware();

        try {
            validateName(name);
        } catch (Exception e) {
            setError(FIELD_NAME, e.getMessage());
        }
        malware.setName(name);

        try {
            validateHash(hash);
        } catch (Exception e) {
            setError(FIELD_HASH, e.getMessage());
        }
        malware.setHash(hash);


        try {
            validateCategory(category);
        } catch (Exception e) {
            setError(FIELD_CATEGORY, e.getMessage());
        }
        malware.setCategory(category);

        try {
            validateDate(creation);
        } catch (Exception e) {
            setError(FIELD_DATE, e.getMessage());
        }
        malware.setDate(creation);

        if (errors.isEmpty()) {
            results = "Sucess";
        } else {
            results = "failure";
        }

        return malware;
    }

    private void validateName(String name) throws Exception {
        if (name.length() < 3 || name == null) {
            throw new Exception("Please enter a valide name.");
        }
    }

    private void validateCategory(String category) throws Exception {
        if (category.length() < 5 || category == null) {
            throw new Exception("Please enter a valide category .");
        }
    }

    private void validateDate(String date) throws Exception {
        if (date.length() < 10 || date == null) {
            throw new Exception("Please enter a valide date .");
        }
    }

    private void validateHash(String hash) throws Exception {
        if (hash.length() < 12 || hash == null) {
            throw new Exception("Please enter a valide hash.");
        }
    }

    private void setError(String field, String message) {
        errors.put(field, message);
    }

    private static String getValuefield(HttpServletRequest request, String nomChamp) {
        String value = request.getParameter(nomChamp);
        if (value == null || value.trim().length() == 0) {
            return null;
        } else {
            return value.trim();
        }
    }
}
